*possession*  Flexible session management for Neovim.


COMMANDS                                                 *possession-commands*

In commands with optional `name` argument, if the argument is omitted then
last loaded/saved session will be used.

                                                             *:PossessionSave*
:PossessionSave [{name}]~

Save the current session information under `session_dir`. Use
`:PossessionSave! [{name}]` to avoid asking for confirmation when overwriting
existing session file.

                                                             *:PossessionLoad*
:PossessionLoad [{name}]~

Load given session from disk.

                                                            *:PossessionClose*
:PossessionClose~

Close current session deleting all open buffers. To delete buffers with
unsaved changes use `:PossessionClose!`.

                                                           *:PossessionDelete*
:PossessionDelete [{name}]~

Delete given session file. `:PossessionDelete!` will not ask for confirmation.

                                                             *:PossessionShow*
:PossessionShow [{name}]~

Show given session info.

                                                             *:PossessionList*
:PossessionList~

List available sessions. `:PossessionList!` will not hide the `vimscript`
field that contains commands generated by |:mksession|.

                                                          *:PossessionMigrate*
:PossessionMigrate {dir_or_file}~

Migrate regular |:mksession|-based session file to current `session_dir`. If a
directory is specified all files inside it will be migrated. Migration tries
to generate valid possession JSON files. It is a best-effort algorithm that
tries to guess session name from file name (without extension) and parses
vimscript to find `cwd`.


CONFIGURATION                                              *possession-config*

To configure the plugin use:
>
    require('possession').setup { ... }
<
The following configuration options are available:

session_dir~
    `string`
    Path under which the session files are saved.

silent~
    `boolean`
    Suppress info messages.

load_silent~
    `boolean`
    Suppress Vim output when sourcing vimscript that loads the session.

debug~
    `boolean`
    Show debug logs.

prompt_no_cr~
    `boolean`
    When this option is set to true, yes/no prompts will use |getchar()| so
    that there is no need to hit enter (`<CR>`) - just hit `y` or `n`. When
    `prompt_no_cr = false`, `vim.ui.input` is used and you must hit enter to
    confirm the answer.

commands~
    `table | nil`
    If set to falsy value then no commands will be created.

commands.*~
    `string | nil`
    Allows to change the name of the `:Possession*` commands (e.g.
    `commands.save = 'SSave'`) or disable the command if set to a falsy value.

                                                         *possession-autosave*
autosave.current~
    `boolean | function(name: string): boolean`
    Automatically save current session if it exists. If no session has been
    loaded yet, then `autosave.tmp` setting is checked.

autosave.tmp~
    `boolean | function(name: string): boolean`
    Automatically save a temporary session if no session has been loaded yet.

autosave.tmp_name~
    `string`
    Name used for the temporary session when `autosave.tmp` is enabled.

autosave.on_load~
    `boolean`
    Run auto-save when loading another session, e.g. when using the
    `PossessionLoad` command.

autosave.on_quit~
    `boolean`
    Run auto-save when quitting Neovim during the |VimLeavePre| autocmd.
    Note: to properly save current session when quitting, use |:quitall|, this
    way the current window layout will be preserved.

                                                            *possession-hooks*
hooks.before_save~
    `function(name: string) => table | nil`
    Invoked on `possession.save` before any actions. Receives session name as
    an argument. Should return a table of `user_data` to be stored in the
    session file. This hook can also return a falsy value to abort session
    saving.

hooks.after_save~
    `function(name: string, user_data: table, aborted: boolean)`
    Invoked just before `possession.save` returns. Receives the final
    `user_data` that has been used for saving. If `aborted` is `true` then the
    session haven't been saved.

hooks.before_load~
    `function(name: string, user_data: table): table | nil`
    Invoked on `possession.load` just after retrieving session data. Receives
    session name and `user_data` for the session to be loaded. This hook
    can modify `user_data` or return it as is. If a falsy value is returned
    then loading will be aborted.

hooks.after_load~
    `function(name: string, user_data: table)`
    Invoked just before `possession.load` returns. Receives the `user_data`
    from the `before_load` hook.

                                                   *possession-plugins-config*
plugins~
    `table`
    This table contains configuration options for |possession-plugins|. Some
    keys are common to each plugin. The rest depends on a specific plugin.

plugins.*~
    `table | boolean`
    This is plugin configuration table. It can be set to `false` to disable a
    plugin. If set to `true` the plugin will be enabled with an empty table,
    which is sufficient with plugins that take no options.

plugins.*.hooks~
    `table { string } | nil`
    List of hook names which are enabled for this plugin. If set to `nil` then
    all hooks will be enabled (only the ones actually used by the plugin).
    Setting this to an empty table (`{}`) will disable all hooks.

                                                    *possession-close-windows*

Plugin that simply closes Vim windows on given hooks. Windows to close are
determined by configured matching rules.

Note: to delete buffers match them with |possession-close-windows| and wait
for |possession-delete-hidden-buffers| to do its job.

plugins.close_windows.preserve_layout~
    `boolean | function(window: number): boolean`
    When deleting a window preserve overall windows layout by replacing the
    window's buffer with a throwaway scratch buffer.

plugins.close_windows.match~
    `table`
    Rules for selecting windows to be closed.

plugins.close_windows.match.floating~
    `boolean`
    Match floating windows. It is recommended to set this to `true` as
    floating window may cause |:mksession| to mess up windows layout.

plugins.close_windows.match.buftype~
    `table { string }`
    List of 'buftype's that will match window's buffer.

plugins.close_windows.match.filetype~
    `table { string }`
    List of 'filetype's that will match window's buffer.

plugins.close_windows.match.custom~
    `boolean | function(window: number): boolean`
    Can be used for arbitrary window matching logic. Windows for which the
    function returns `true` will be closed.

                                            *possession-delete-hidden-buffers*

Plugin that deletes hidden buffers (buffers with no associated windows).
It will always run after |possession-close-windows| so all the previously
closed windows will also have their buffers deleted.

Note: instead of using this plugin on `before_save`, one could remove
`buffers` from 'sessionoptions' (or have both), which would ignore any
hidden buffers when saving sessions.

plugins.delete_hidden_buffers.force~
    `boolean | function(buffer: number): boolean`
    Delete buffers even if they contain changes.

    WARNING: this may lead to loosing unsaved changes. Instead of using this
    option consider removing `buffers` from 'sessionoptions'.

                                                   *possession-delete-buffers*

This plugin forcefully deletes all buffers before loading new session (on
`before_load` hook). This may be especially useful if using `buffers` in
'sessionopts' (if you need to store hidden buffers in sessions).

                                                        *possession-nvim-tree*

Saves nvim-tree explorer windows and restores them when loading the session.
Currently no configuration options beside enabling/disabling are available.

                                                            *possession-tabby*

Saves tabby.nvim tab page names when saving the sessions and restores them
when loading.
Currently no configuration options beside enabling/disabling are available.


PLUGINS                                                   *possession-plugins*

Plugins are extensions that perform additional actions on hooks, similarly to
how user hooks work. Possession plugins are not equivalent to Vim plugins,
i.e. a possession plugin can implement actions related to an actual Vim
plugin (like closing/restoring `nvlm-tree` windows), but it could also do
any other work that is not related to any particular Vim plugin.

Plugins work by exposing hooks equivalent to the hooks provided to the user,
with some notable differences:

1. Hook functions take additional `config` parameter as first argument. It
contains current plugin configuration as defined under `plugins.<name>` in the
configuration table (set by `setup`, see |possession-config|).
Note: There is NO need to check if the plugin is enabled. This will be done
earlier, so if a plugin hook is called it means that it is enabled.

2. Instead of `user_data`, a `plugin_data` table is used. The plugin can use
it to store/retrieve data between sessions. Any hooks that would return
`user_data` should return this table. Returning `nil` will abort
saving/loading the session! The `plugin_data` table will be stored under
`plugins.<name>` path in the JSON file automatically.


SESSION FILE                                         *possession-session-file*

Session files are stored in JSON format with the following keys:

name~
    `string`
    Session name. The session file name should be in the format `<name>.json`,
    so the information is redundant and mismatch may sometimes lead to
    unexpected results.

cwd~
    `string`
    Vim's current working directory (|getcwd()|) at the moment of session
    creation.

vimscript~
    `string`
    Code genereated by |:mksession| that is used to restore a session.

user_data~
    `table`
    Used to store arbitrary user data. Value of this table is
    generated/available in |possession-hooks|.


vim:tw=78:et:ft=help:norl:
